{% extends "base.html" %}
{% block content %}
<h1>Product Listing</h1>

<!-- Filter and Sort Section -->
<div class="filter-section">
    <form method="get" action="/" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center; width: 100%;">
        <div>
            <label for="category">Filter by Category:</label>
            <select name="category" id="category">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>{{ cat }}</option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="sort">Sort by Price:</label>
            <select name="sort" id="sort">
                <option value="">Default (Newest First)</option>
                <option value="price_asc" {% if selected_sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
                <option value="price_desc" {% if selected_sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
            </select>
        </div>

        <div style="margin-top: 20px;">
            <button type="submit">Apply Filters</button>
        </div>

        <div style="margin-top: 20px;">
            <a href="/" style="text-decoration: none;">
                <button type="button" class="clear-btn">Clear Filters</button>
            </a>
        </div>
    </form>
</div>

<!-- Products Table -->
{% if products %}
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Price</th>
            <th>Category</th>
            <th>Created At</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
        <tr>
            <td>{{ product.name }}</td>
            <td class="price">${{ "%.2f"|format(product.price) }}</td>
            <td>{{ product.category }}</td>
            <td class="timestamp">{{ product.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            <td>
                <a href="{{ url_for('delete_product', product_id=product.id) }}"
                   class="delete-btn"
                   onclick="return confirm('Are you sure you want to delete {{ product.name }}?')">
                    âœ• Delete
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>No products found.</p>
    <a href="{{ url_for('add_product') }}" class="btn" style="max-width: 300px; margin: 0 auto; display: block;">Add Your First Product</a>
</div>
{% endif %}
{% endblock %}
